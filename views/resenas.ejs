<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="imagenes/file.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rese√±as</title>
    <link rel="stylesheet" href="/public/css/resenas.css">
</head>
<body>
   
       


   
    
    <header>
        <div class="logo">
        <img src="imagenes/file.png" height="120">
        </div>
        <nav>
            <a href="/home">inicio</a>
            <a href="/noticias">noticias</a>
            <a href="/resenas">rese√±as</a>
            <a href="/trucosytips">trucos</a>
            <a href="/chat">comunidad</a>
            <% if (es_admin) { %> 
                <a href="/usuarios">usuarios</a> 
            <% } %>
        </nav>
        <div class="registro">      
            <% if (nombreUsuario) { %> 
                <span class="usuario"> <%= nombreUsuario %></span>
                <a class="cerrar" href="/logout">Cerrar sesi√≥n</a>
                <% } else { %>
             <a class="iniciar" href="/login">iniciar sesion</a>
             <a class="regristrarse" href="/usuario/0">registrarse</a>
             <% } %>
        </div>
    </header>
<h1>Rese√±as</h1>

<div class="contenedor-buscador-filtro">
    <form class="formulario" action="/resenas" method="GET">
        <input type="text" name="buscar" value="<%= buscar %>" placeholder="Buscar rese√±as...">
        <button class="buscar" type="submit"><i class="fas fa-search"></i></button>
    </form>
    <form class="filtro" method="get" action="/resenas">
        <label for="order">Ordenar por:</label>
        <select name="filtro" onchange="this.form.submit()">                                                                                                                          
            <option value="recientes" <%= filtro === 'recientes' ? 'selected' : '' %>>M√°s recientes</option>
            <option value="antiguas" <%= filtro === 'antiguas' ? 'selected' : '' %>>M√°s antiguas</option>
            <option value="mas_estrellas" <%= filtro === 'mas_estrellas' ? 'selected' : '' %>>Mejor calificados </option>
            <option value="menos_estrellas" <%= filtro === 'menos_estrellas' ? 'selected' : '' %>>Peor calificados</option>
        </select>
    </form>

    <% if (es_admin) { %>
        <a href="/resenas/crear" class="crear-noticia"><img src="/public/imagenes/361984.png" alt=""></a>
    <% } %>
</div>
<div class="resenas-grid"> 
  <% if (resenas.length > 0) { %>
      <% resenas.forEach(resena => { %>
       
          <div class="resena-cuadro">
              <% if (resena.miniatura) { %>
                  <img src="/uploads/<%= resena.miniatura %>" alt="Miniatura de la rese√±a">
              <% } %>
              
              <div class="resena-info">
                  <h2><%= resena.titulo %></h2>
                  <p><%= resena.contenido.substring(0, 100) %>...</p>
                  <a href="/resenas/<%= resena.id %>">Leer m√°s</a>
              </div>
             
              <div class="estrellas-promedio">
                <% if (typeof resena.promedio_calificacion === 'number') { %>
                    <% for (let i = 1; i <= 5; i++) { %>
                        <% if (i <= Math.floor(resena.promedio_calificacion)) { %>
                            &#9733; <!-- Estrella llena -->
                        <% } else if (i === Math.ceil(resena.promedio_calificacion) && (resena.promedio_calificacion % 1) >= 0.5) { %>
                            &#9733; <!-- Estrella media -->
                        <% } else { %>
                            &#9734; <!-- Estrella vac√≠a -->
                        <% } %>
                    <% } %>
                <% } else { %>
                    <p>No calificado a√∫n</p>
                <% } %>
            </div>
            
              <% if (es_admin) { %>
                  <div class="acciones-admin">
                      <a href="/resenas/<%= resena.id %>/editar" class="editar">‚úé Actualizar</a>
                      <form class="botoneliminar" action="/resenas/<%= resena.id %>/eliminar" method="POST" onsubmit="return confirm('¬øEst√°s seguro de que deseas eliminar esta rese√±a?');">
                          <button type="submit" class="btn-eliminar">üóëÔ∏è Eliminar</button>
                      </form>
                  </div>
              <% } %>
          </div>
          
      <% }) %>
  <% } else { %>
      <p>No hay rese√±as disponibles</p>
  <% } %>
</div>
<ul class="paginador">
    <!-- Bot√≥n Anterior -->
    <% if (pagina > 1) { %>
        <li>
            <a href="/resenas?buscar=<%= buscar %>&pagina=<%= pagina - 1 %>&filtro=<%= filtro %>"><</a>
        </li>
    <% } %>

    <!-- N√∫meros de p√°ginas -->
    <% for (let i = 1; i <= totalPaginas; i++) { %>
        <li class="<%= pagina === i ? 'activo' : '' %>">
            <a href="/resenas?buscar=<%= buscar %>&pagina=<%= i %>&filtro=<%= filtro %>"><%= i %></a>
        </li>
    <% } %>

    <!-- Bot√≥n Siguiente -->
    <% if (pagina < totalPaginas) { %>
        <li>
            <a href="/resenas?buscar=<%= buscar %>&pagina=<%= pagina + 1 %>&filtro=<%= filtro %>">></a>
        </li>
    <% } %>
</ul>




<footer>
    <div class="footerconteiner">
      <div class="imagenfooter">
         <img src="/imagenes/file.png" height="150" width="150">
      </div>
       <div class="redes">
         <h4>¬°siguenos!</h4>
         <a href="https://www.facebook.com/tuUsuario" target="_blank">
             <i class="fab fa-facebook-f"></i>
         </a>
         <a href="https://www.twitter.com/tuUsuario" target="_blank">
             <i class="fab fa-twitter"></i>
         </a>
         <a href="https://www.instagram.com/tuUsuario" target="_blank">
             <i class="fab fa-instagram"></i>
         </a>
         <a href="https://www.linkedin.com/in/tuUsuario" target="_blank">
             <i class="fab fa-linkedin-in"></i>
         </a>
         <a href="https://www.snapchat.com/add/tuUsuario" target="_blank">
             <i class="fab fa-snapchat"></i>
         </a>
         <a href="https://www.tiktok.com/@tuUsuario" target="_blank">
             <i class="fab fa-tiktok"></i>
         </a>
         <a href="https://wa.me/tuNumeroDeTelefono" target="_blank">
             <i class="fab fa-whatsapp"></i>
         </a>
         <a href="https://www.youtube.com/tuUsuario" target="_blank">
             <i class="fab fa-youtube"></i>
         </a>
       </div>
       <div class="links"> 
         <h4>mas links</h4>
         <ul>
             <li><a href="/home">inicio</a></li>
             <li><a href="/ayuda">ayuda</a></li>
             <li><a href="/contactos">contactanos</a></li>
             <li><a href="/politicas">politica de privacidad</a></li>
         </ul>
       </div>
    </div>       
</footer>
<script src="/public/js/index.js"></script>
</body>
</html>